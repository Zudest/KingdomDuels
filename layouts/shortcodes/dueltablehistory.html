{{/* Kingdom Duels Shortcode - /layouts/shortcodes/dueltablehistory.html */}}

<style>
  .kingdom-duels-table-history table {
    border-collapse: collapse;
    width: 50%;
    margin-bottom: 20px;
  }
  .kingdom-duels-table-history th {
    background-color: #3a3a3a;
    color: white;
    font-weight: bold;
    text-align: center;
    padding: 8px 4px;
  }
  .kingdom-duels-table-history td {
    border: 1px solid #ddd;
    padding: 4px;
  }
  .kingdom-duels-table-history .total-row {
    background-color: #3a3a3a !important;
    color: white;
    font-weight: bold;
  }
  .kingdom-duels-table-history .duel-win { color: rgb(44, 192, 93); }
  .kingdom-duels-table-history .duel-lose { color: rgb(221, 72, 72); }
  .kingdom-duels-table-history .duel-draw { color: rgb(83, 198, 233); }
  .kingdom-duels-table-history .duel-dnf { color: rgb(182, 80, 196); }
  .kingdom-duels-table-history .duel-unknown { color: rgb(182, 80, 196); }
  </style>

<div class="kingdom-duels-table-history">
  <table>
    <thead>
      <tr>
        <th style="width: 60%">Matchup</th>
        <th style="width: 20%">Episode(s)</th>
        <th style="width: 20%">Outcome</th>
      </tr>
    </thead>
    <tbody>
      {{- $rows := split (trim .Inner "\n") "\n" -}}
      {{- $wins := 0 -}}
      {{- $losses := 0 -}}
      {{- $others := 0 -}}

      {{- range $rows -}}
        {{- if ne . "" -}}
        <tr>
          {{- $cells := split . "|" -}}
          {{- $duelResultValue := index $cells 2 | default "" -}}
          {{- $duelResult := "" -}}
          
          {{- if in (lower $duelResultValue) "win" -}}
            {{- $duelResult = "duel-win" -}}
            {{- $wins = add $wins 1 -}}
          {{- else if in (lower $duelResultValue) "loss" -}}
            {{- $duelResult = "duel-lose" -}}
            {{- $losses = add $losses 1 -}}
          {{- else if in (lower $duelResultValue) "draw" -}}
            {{- $duelResult = "duel-draw" -}}
            {{- $others = add $others 1 -}}
          {{- else if in (lower $duelResultValue) "dnf" -}}
            {{- $duelResult = "duel-dnf" -}}
            {{- $others = add $others 1 -}}
          {{- else if in (lower $duelResultValue) "?" -}}
            {{- $duelResult = "duel-unknown" -}}
            {{- $others = add $others 1 -}}
          {{- end -}}
          <td style="text-align: center">{{ index $cells 0 | default "" | markdownify }}</td>
          <td style="text-align: center">{{ index $cells 1 | default "" | markdownify }}</td>
          <td class="{{ $duelResult }}" style="text-align: center">{{ $duelResultValue }}</td>
        </tr>
        {{- end -}}
      {{- end -}}

      <tr class="total-row">
        <td colspan="3" style="text-align: center">
          Total Record: {{ $wins }}-{{ $others }}-{{ $losses }}
        </td>
      </tr>
    </tbody>
  </table>
</div>
